name: Daily Trading Bot

on:
  schedule:
    # ðŸ•’ SWING TRADING SCHEDULE (IST vs UTC)
    # IST is UTC + 5:30
    # ---------------------------------------
    # 10:15 AM IST = 04:45 UTC (Market settled)
    # 01:15 PM IST = 07:45 UTC (Mid-day check)
    # 03:15 PM IST = 09:45 UTC (Closing confirmation - Critical)
    
    - cron: '45 4,7,9 * * 1-5'
  
  workflow_dispatch: # Manual "Run Now" button

jobs:
  trade:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pandas-ta-classic yfinance sqlalchemy psycopg2-binary requests

      - name: Run Bot
        env:
          UPSTOX_ACCESS_TOKEN: ${{ secrets.UPSTOX_ACCESS_TOKEN }}
          INDIANAPI_KEY: ${{ secrets.INDIANAPI_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          PAPER_MODE: ${{ secrets.PAPER_MODE }}
        
        run: python main.py